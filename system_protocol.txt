NOTICE

- values are all big-endian
- for constants see common/HostStatus

TODO: update

SERVER

loop
	recieve message
		if organizer ping [RECV 0x0b: u8] // "organizer bonk"
			pong [SEND 0x5a: u8] // "server answer"
		if (client) connection request and camera info [RECV 0xcc: u8, x: f64, y: f64, rotation: f64, fov: f64] // "client connect"
			accept, add to clients
		if (client) value update [RECV value: f64]
			update value
			if all values updated
				calculate new position
				notify subscribers
kill all clients [SEND 0xcd: u8] // "client die command"

CLIENT

outer loop
	wait for organizer ping [RECV 0x0b: u8] // "organizer bonk"
	reply with pong [SEND 0xcf: u8] // "client fucking around"
	wait for organizer start [RECV 0x60: u8] // "go"
	send image from camera // [SEND len: u64, img: [u8]]
	recieve camera info and server ip [RECV x: f64, y: f64, rotation: f64, fov: f64, ip_len: u16, ip: [u8]]
	connect to server
		send connection request and camera info [SEND 0xcc: u8, x: f64, y: f64, rotation: f64, fov: f64] // "client connect"
	inner loop
		check for command
			if stop [RECV 0xcd: u8] // "client die command"
				break (inner)
			if organizer ping [RECV 0x0b: u8] // "organizer bonk"
				reply with pong [SEND 0xca: u8] // "client active"
		find x value
		send value to server [SEND value: f64]


NOCONFIG CLIENT
	wait for organizer ping [RECV 0x0b: u8] // "organizer bonk"
	reply with pong [SEND 0xcf: u8] // "client fucking around"
	wait for organizer start [RECV 0x60: u8] // "go"
	connect to server
		send connection request and camera info [SEND 0xcc: u8, x: f64, y: f64, rotation: f64, fov: f64] // "client connect"
	inner loop
		check for command
			if stop [RECV 0xcd: u8] // "client die command"
				break (inner)
			if organizer ping [RECV 0x0b: u8] // "organizer bonk"
				reply with pong [SEND 0xca: u8] // "client active"
		find x value
		send value to server [SEND value: f64]

ORGANIZER

thread 1
	loop through ips
		send ping [SEND 0x0b: u8] // "organizer bonk"
		if offline
			continue
		if server [RECV 0x5a: u8] // "server answer"
			set server ip
		if client [RECV 0xca: u8] // "client active"
			add / move to active clients
		if client [RECV 0xcf: u8] // "client fucking around"
			add / move to to idle clients

on user input
	loop through actions
		if client start
			send start [SEND 0x60: u8] // "go"
			recieve image [RECV TODO]
			show image to user and prompt for camera info
			send camera info and server ip [SEND x: f64, y: f64, rotation: f64, fov: f64, ip_len: u16, ip: [u8]]
		if client stop
			send stop [SEND 0xcd: u8] // "client die command"
